<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic Level Test - Arabfield Academy</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpg" href="images/logo.jpg">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Arabic Level Test - Arabfield Academy">
    <meta property="og:description" content="Discover your Arabic proficiency level with our adaptive test. Find the perfect starting point for your language learning journey.">
    <meta property="og:image" content="https://arabfieldacademy.netlify.app/images/social-preview.jpg">
    <meta property="og:url" content="https://arabfieldacademy.netlify.app/level-test.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Arabfield Academy">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Arabic Level Test - Arabfield Academy">
    <meta name="twitter:description" content="Discover your Arabic proficiency level with our adaptive test. Find the perfect starting point for your language learning journey.">
    <meta name="twitter:image" content="https://arabfieldacademy.netlify.app/images/social-preview.jpg">

    <link rel="stylesheet" href="style.css">
    <style>
        /* Styles remain the same */
        .level-test-container { max-width: 800px; margin: 0 auto; font-family: var(--font-arabic), var(--font-main); }
        #intro-screen { text-align: center; }
        #intro-screen h2 { font-size: 32px; color: var(--primary-blue); }
        #intro-screen p { font-size: 18px; color: #555; margin-bottom: 30px; }
        #test-screen { display: none; }
        .level-header { text-align: center; margin-bottom: 20px; }
        .level-title { font-size: 24px; color: var(--primary-blue); margin-bottom: 5px; }
        .level-subtitle { font-size: 16px; color: #777; }
        .progress-bar-container { width: 100%; background-color: var(--border-color); border-radius: 10px; margin-bottom: 30px; overflow: hidden; }
        .progress-bar { width: 0%; height: 15px; background-color: var(--secondary-orange); border-radius: 10px; transition: width 0.4s ease-in-out; }
        .question-container { margin-bottom: 30px; text-align: center; }
        .question-text { font-size: 28px; color: var(--primary-blue); margin-bottom: 25px; }
        .options-grid { list-style: none; padding: 0; display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .options-grid { grid-template-columns: 1fr 1fr; } }
        .option-card { background-color: #f8f9fa; border: 2px solid var(--border-color); border-radius: 8px; padding: 20px; font-size: 18px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; min-height: 80px; }
        .option-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); border-color: var(--primary-blue); }
        .option-card.icon-card { flex-direction: column; gap: 10px; font-size: 20px; }
        .option-card.icon-card .icon { font-size: 36px; color: var(--secondary-orange); }
        .option-card.sentence-card { justify-content: flex-end; text-align: right; font-size: 22px; }
        .options-grid.disabled .option-card { pointer-events: none; opacity: 0.7; }
        .option-card.correct { background-color: #d4edda; border-color: #28a745; color: #155724; font-weight: bold; }
        .option-card.incorrect { background-color: #f8d7da; border-color: #dc3545; color: #721c24; font-weight: bold; }
        .feedback-message { margin-top: 20px; font-size: 20px; font-weight: bold; height: 30px; }
        .feedback-message.correct { color: #28a745; }
        .feedback-message.incorrect { color: #dc3545; }
        #results-screen { display: none; text-align: center; background-color: var(--very-light-blue); padding: 40px; border-radius: 12px; }
        #results-screen h2 { font-size: 32px; color: var(--primary-blue); }
        #results-screen .level-badge { display: inline-block; background-color: var(--secondary-orange); color: white; padding: 10px 20px; border-radius: 25px; font-size: 24px; font-weight: bold; margin: 10px 0 20px 0; }
        #results-screen .result-summary { font-size: 18px; font-weight: bold; color: var(--primary-blue); margin-bottom: 15px; }
        #recommended-reading { margin-top: 40px; background-color: white; padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); display: none; }
        #recommended-reading h4 { margin-top: 0; color: var(--primary-blue); }
        #recommended-reading ul { list-style: none; padding: 0; }
        #recommended-reading li a { text-decoration: none; font-weight: bold; color: var(--secondary-orange); }
    </style>
    <script src="app.js" defer></script>
</head>
<body>
    <header class="main-header" id="main-header-placeholder"></header>

    <section class="hero-section">
        <h1>Find Your Perfect Arabic Level</h1>
        <p>Plant the language, Harvest the culture</p>
    </section>

    <section class="section">
        <div class="level-test-container">
            <div id="intro-screen">
                <h2>Ready to Discover Your Arabic Proficiency?</h2>
                <p>This adaptive test is divided into levels. Your performance determines if you advance to the next level. Let's begin!</p>
                <button id="start-test-btn" class="btn btn-primary">Start the Test</button>
            </div>

            <div id="test-screen">
                <div class="level-header">
                    <h3 class="level-title" id="level-title"></h3>
                    <p class="level-subtitle" id="level-subtitle"></p>
                </div>
                <div class="progress-bar-container"><div class="progress-bar" id="progress-bar"></div></div>
                <div id="question-container"></div>
            </div>

            <div id="results-screen"></div>
        </div>
    </section>

    <footer class="main-footer" id="main-footer-placeholder"></footer>
    <div class="fab-container" id="fabs-placeholder"></div>

    <script>
        // All JS logic remains the same, no name change needed here as it's functional code.
        // The only potential change is in the results screen text, which I will update.
        document.addEventListener("DOMContentLoaded", function() {
            const introScreen = document.getElementById('intro-screen');
            const testScreen = document.getElementById('test-screen');
            const resultsScreen = document.getElementById('results-screen');
            const startTestBtn = document.getElementById('start-test-btn');
            const questionContainer = document.getElementById('question-container');
            const progressBar = document.getElementById('progress-bar');
            const levelTitle = document.getElementById('level-title');
            const levelSubtitle = document.getElementById('level-subtitle');

            let currentLevelIndex = 0;
            let questionInLevel = 0;
            let levelScore = 0;
            let wrongAnswersTopics = new Set();

            const levels = [
                {
                    title: "Level 1: The Basics",
                    subtitle: "Let's start with the fundamentals.",
                    pass_score: 3,
                    questions: [
                        { type: 'icon-card', q: "Which one means 'House'?", options: [{text: "Ø¨Ø§Ø¨", icon: "ðŸšª"}, {text: "ÙƒØªØ§Ø¨", icon: "ðŸ“–"}, {text: "Ø¨ÙŠØª", icon: "ðŸ "}, {text: "Ù‚Ù„Ù…", icon: "âœï¸"}], a: "Ø¨ÙŠØª", topic: "vocab" },
                        { type: 'simple-card', q: "How do you say 'Thank you'?", options: ["Ù…Ø±Ø­Ø¨Ø§Ù‹", "Ø´ÙƒØ±Ø§Ù‹", "Ø¢Ø³Ù", "ÙˆØ¯Ø§Ø¹Ø§Ù‹"], a: "Ø´ÙƒØ±Ø§Ù‹", topic: "vocab" },
                        { type: 'simple-card', q: "What is the color 'Red'?", options: ["Ø£Ø²Ø±Ù‚", "Ø£Ø®Ø¶Ø±", "Ø£ØµÙØ±", "Ø£Ø­Ù…Ø±"], a: "Ø£Ø­Ù…Ø±", topic: "vocab" },
                        { type: 'simple-card', q: "The opposite of 'big' (ÙƒØ¨ÙŠØ±) is:", options: ["Ø·ÙˆÙŠÙ„", "ØµØºÙŠØ±", "Ø¬Ø¯ÙŠØ¯", "Ø¬Ù…ÙŠÙ„"], a: "ØµØºÙŠØ±", topic: "vocab" }
                    ]
                },
                {
                    title: "Level 2: Building Sentences",
                    subtitle: "Now let's test your grammar.",
                    pass_score: 3,
                    questions: [
                        { type: 'sentence-card', q: "Choose the correct sentence:", options: ["Ø£Ù†Ø§ Ø£Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", "Ø£Ù†Ø§ ÙŠØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", "Ø£Ù†Ø§ Ù†Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", "Ø£Ù†Ø§ ØªØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©"], a: "Ø£Ù†Ø§ Ø£Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", topic: "conjugation" },
                        { type: 'simple-card', q: "What is the singular of 'books' (ÙƒÙØªÙØ¨)?", options: ["ÙƒØ§ØªØ¨", "Ù…ÙƒØªØ¨Ø©", "ÙƒØªØ§Ø¨", "Ù…ÙƒØªÙˆØ¨"], a: "ÙƒØªØ§Ø¨", topic: "vocab" },
                        { type: 'sentence-card', q: "Which sentence is in the past tense?", options: ["Ø§Ù„ÙˆÙ„Ø¯ ÙŠÙ„Ø¹Ø¨ Ø¨Ø§Ù„ÙƒØ±Ø©", "Ø§Ù„ÙˆÙ„Ø¯ Ø³ÙˆÙ ÙŠÙ„Ø¹Ø¨ Ø¨Ø§Ù„ÙƒØ±Ø©", "Ø§Ù„ÙˆÙ„Ø¯ Ù„Ø¹Ø¨ Ø¨Ø§Ù„ÙƒØ±Ø©", "Ø§Ù„ÙˆÙ„Ø¯ ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ø¢Ù†"], a: "Ø§Ù„ÙˆÙ„Ø¯ Ù„Ø¹Ø¨ Ø¨Ø§Ù„ÙƒØ±Ø©", topic: "conjugation" },
                        { type: 'sentence-card', q: "My sister is an engineer. (Ù…Ù‡Ù†Ø¯Ø³Ø©)", options: ["Ø£Ø®ÙŠ Ù…Ù‡Ù†Ø¯Ø³Ø©", "Ø£Ø®ØªÙŠ Ù…Ù‡Ù†Ø¯Ø³Ø©", "Ø£Ø¨ÙŠ Ù…Ù‡Ù†Ø¯Ø³Ø©", "ØµØ¯ÙŠÙ‚ÙŠ Ù…Ù‡Ù†Ø¯Ø³Ø©"], a: "Ø£Ø®ØªÙŠ Ù…Ù‡Ù†Ø¯Ø³Ø©", topic: "vocab" }
                    ]
                },
                {
                    title: "Level 3: Advanced Concepts",
                    subtitle: "Let's see how deep your knowledge goes.",
                    pass_score: 0,
                    questions: [
                        { type: 'simple-card', q: "The word 'Ù…ÙƒØªØ¨Ø©' (library) comes from the root:", options: ["Ùƒ-Øª-Ø¨", "Ù‚-Ø±-Ø£", "Ø¹-Ù„-Ù…", "Ø¯-Ø±-Ø³"], a: "Ùƒ-Øª-Ø¨", topic: "roots" },
                        { type: 'sentence-card', q: "Which one means 'The door of the house'?", options: ["Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø¨ÙŠØª", "Ø¨Ø§Ø¨ Ø§Ù„Ø¨ÙŠØªÙ", "Ø¨Ø§Ø¨ÙŒ Ø¨ÙŠØªÙ", "Ø§Ù„Ø¨Ø§Ø¨Ù Ø§Ù„Ø¨ÙŠØªÙŽ"], a: "Ø¨Ø§Ø¨ Ø§Ù„Ø¨ÙŠØªÙ", topic: "idafa" },
                        { type: 'simple-card', q: "In 'Ø±Ø£ÙŠØªÙ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŽ', the word 'Ø§Ù„Ù…Ø¹Ù„Ù…' is:", options: ["ÙØ§Ø¹Ù„ (Subject)", "Ù…ÙØ¹ÙˆÙ„ Ø¨Ù‡ (Object)", "Ù…Ø¨ØªØ¯Ø£", "Ø®Ø¨Ø±"], a: "Ù…ÙØ¹ÙˆÙ„ Ø¨Ù‡ (Object)", topic: "cases" },
                        { type: 'simple-card', q: "Which letter is a 'Sun Letter' (Ø­Ø±Ù Ø´Ù…Ø³ÙŠ)?", options: ["Ø¨", "Ø¬", "Ù…", "Ø´"], a: "Ø´", topic: "sun-moon" }
                    ]
                }
            ];

            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function startTest() {
                introScreen.style.display = 'none';
                testScreen.style.display = 'block';
                wrongAnswersTopics.clear();
                loadLevel();
            }

            function loadLevel() {
                const level = levels[currentLevelIndex];
                levelTitle.textContent = level.title;
                levelSubtitle.textContent = level.subtitle;
                questionInLevel = 0;
                levelScore = 0;
                loadQuestion();
            }

            function loadQuestion() {
                const level = levels[currentLevelIndex];
                if (questionInLevel >= level.questions.length) {
                    moveToNextLevel();
                    return;
                }

                progressBar.style.width = `${((questionInLevel + 1) / level.questions.length) * 100}%`;
                const q = level.questions[questionInLevel];
                let shuffledOptions = (q.type === 'icon-card') ? shuffle([...q.options]) : shuffle([...q.options]);

                let optionsHTML = shuffledOptions.map(opt => {
                    if (q.type === 'icon-card') {
                        return `<li class="option-card icon-card" data-answer="${opt.text}"><span class="icon">${opt.icon}</span><span>${opt.text}</span></li>`;
                    }
                    return `<li class="option-card ${q.type}" data-answer="${opt}">${opt}</li>`;
                }).join('');

                questionContainer.innerHTML = `
                    <div class="question-text">${q.q}</div>
                    <ul class="options-grid">${optionsHTML}</ul>
                    <div class="feedback-message"></div>`;
            }

            questionContainer.addEventListener('click', function(e) {
                const card = e.target.closest('.option-card');
                if (card && !card.parentElement.classList.contains('disabled')) {
                    const grid = card.parentElement;
                    grid.classList.add('disabled');
                    
                    const currentQuestion = levels[currentLevelIndex].questions[questionInLevel];
                    const selectedAnswer = card.dataset.answer;
                    const correctAnswer = currentQuestion.a;
                    const isCorrect = selectedAnswer === correctAnswer;

                    if (isCorrect) {
                        levelScore++;
                        card.classList.add('correct');
                        grid.nextElementSibling.textContent = "Excellent! âœ…";
                        grid.nextElementSibling.className = 'feedback-message correct';
                    } else {
                        card.classList.add('incorrect');
                        grid.nextElementSibling.textContent = "Not quite, but good try! ðŸ¤”";
                        grid.nextElementSibling.className = 'feedback-message incorrect';
                        wrongAnswersTopics.add(currentQuestion.topic);
                        
                        const correctCard = grid.querySelector(`[data-answer="${correctAnswer}"]`);
                        if(correctCard) {
                            correctCard.classList.add('correct');
                            correctCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }

                    setTimeout(() => {
                        questionInLevel++;
                        loadQuestion();
                    }, 2000);
                }
            });

            function moveToNextLevel() {
                const level = levels[currentLevelIndex];
                if (levelScore >= level.pass_score && currentLevelIndex < levels.length - 1) {
                    currentLevelIndex++;
                    loadLevel();
                } else {
                    showResults();
                }
            }

            function showResults() {
                testScreen.style.display = 'none';
                resultsScreen.style.display = 'block';
                let finalLevel, levelCode, resultSummary, resultText, recommendedProgram;

                if (currentLevelIndex === 2 && levelScore >= 2) {
                    finalLevel = 'Advanced'; levelCode = 'B2/C1';
                    resultSummary = "Mashallah! Your knowledge is impressive.";
                    resultText = 'You have an excellent command of Arabic grammar and vocabulary. Our advanced courses can help you achieve near-native fluency.';
                    recommendedProgram = 'Advanced Program or Exam Preparation';
                } else if (currentLevelIndex >= 1) {
                    finalLevel = 'Intermediate'; levelCode = 'A2/B1';
                    resultSummary = "Great job! You have a solid foundation.";
                    resultText = 'You have a good grasp of the basics. Our intermediate courses are perfect for building your conversational skills and grammatical accuracy.';
                    recommendedProgram = 'Modern Standard Arabic (MSA) or Egyptian Colloquial';
                } else {
                    finalLevel = 'Beginner'; levelCode = 'A1';
                    resultSummary = "A great start to an exciting journey!";
                    resultText = 'You\'re at the beginning of a rewarding adventure. Our beginner courses will give you the confidence to start speaking and understanding basic Arabic.';
                    recommendedProgram = 'Modern Standard Arabic (MSA) - Beginner';
                }

                const readingList = {
                    roots: '<li><a href="posts/post-vocabulary-roots.html" target="_blank">Review the Arabic Root System</a></li>',
                    idafa: '<li><a href="posts/post-idafa-construction.html" target="_blank">Mastering the Idafa Construction</a></li>',
                    conjugation: '<li><a href="posts/post-verb-conjugation.html" target="_blank">Understanding Verb Conjugation</a></li>',
                    'sun-moon': '<li><a href="posts/post-sun-moon-letters.html" target="_blank">The Sun and Moon Letters</a></li>'
                };
                let recommendedHTML = '';
                wrongAnswersTopics.forEach(topic => {
                    if (readingList[topic]) {
                        recommendedHTML += readingList[topic];
                    }
                });

                resultsScreen.innerHTML = `
                    <h2>Your Estimated Level</h2>
                    <div class="level-badge">${finalLevel} (${levelCode})</div>
                    <p class="result-summary">${resultSummary}</p>
                    <p>${resultText}</p>
                    
                    <a href="index.html#register" class="btn btn-primary" style="margin-top: 20px; margin-bottom: 30px; transform: scale(1.
                    <a href="index.html#register" class="btn btn-primary" style="margin-top: 20px; margin-bottom: 30px; transform: scale(1.1);">Book a Free Trial to Confirm Your Level</a>

                    <div style="background-color: white; padding: 20px; border-radius: 8px; border: 1px solid var(--border-color);">
                        <h4>Our Program Recommendation:</h4>
                        <p>Based on your results, we suggest starting with our <strong>${recommendedProgram}</strong> course.</p>
                        <a href="programs.html" class="btn btn-secondary">Explore Program</a>
                    </div>

                    <div id="recommended-reading">
                        <h4>To strengthen your skills, we recommend reading:</h4>
                        <ul>${recommendedHTML}</ul>
                    </div>
                `;

                if (recommendedHTML) {
                    document.getElementById('recommended-reading').style.display = 'block';
                }
            }

            startTestBtn.addEventListener('click', startTest);
        });
    </script>
</body>
</html>