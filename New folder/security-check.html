<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security System Check - Arabfield Academy</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .security-dashboard {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .system-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #f57c00;
        }
        .system-card.active { border-left-color: #4CAF50; }
        .system-card.inactive { border-left-color: #f44336; }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-active { background: #4CAF50; color: white; }
        .status-inactive { background: #f44336; color: white; }
        .test-buttons { margin: 20px 0; }
        .test-result { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <header class="main-header" id="main-header-placeholder"></header>

    <section class="hero-section">
        <h1>Security System Dashboard</h1>
        <p>مراقبة واختبار أنظمة الحماية</p>
    </section>

    <section class="section">
        <div class="security-dashboard">
            <div class="system-card" id="overview-card">
                <h2>نظام الحماية الشامل</h2>
                <div id="system-status">جاري التحميل...</div>
            </div>

            <div class="test-buttons">
                <button class="btn btn-primary" onclick="runSecurityTests()">تشغيل اختبارات الحماية</button>
                <button class="btn btn-secondary" onclick="checkSystemHealth()">فحص صحة النظام</button>
                <button class="btn" onclick="viewSecurityLogs()">عرض سجلات الأمان</button>
            </div>

            <div class="test-result" id="test-result"></div>

            <div class="system-card">
                <h3>اختبار النماذج المحمية</h3>
                <form id="test-form" class="contact-form">
                    <div class="form-group">
                        <label>الاسم:</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group">
                        <label>البريد الإلكتروني:</label>
                        <input type="email" name="email" required>
                    </div>
                    <button type="submit" class="btn btn-primary">اختبار الإرسال</button>
                </form>
            </div>

            <div class="system-card">
                <h3>معلومات الجلسة</h3>
                <div id="session-info"></div>
            </div>
        </div>
    </section>

    <footer class="main-footer" id="main-footer-placeholder"></footer>

    <script src="security-init.js"></script>
    <script src="app.js"></script>
    <script>
        // دالة تحديث حالة النظام
        function updateSystemStatus() {
            if (window.securitySystem) {
                const status = window.securitySystem.getSystemStatus();
                const statusHTML = `
                    <p><strong>الأنظمة النشطة:</strong> ${status.activeSystems} / ${status.totalSystems}</p>
                    <div class="system-list">
                        ${Object.keys(status.systems).map(sys => `
                            <div class="system-item">
                                <span>${sys}:</span>
                                <span class="status-badge ${status.systems[sys] === 'ACTIVE' ? 'status-active' : 'status-inactive'}">
                                    ${status.systems[sys]}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                `;
                document.getElementById('system-status').innerHTML = statusHTML;
            }
        }

        // اختبارات الحماية
        function runSecurityTests() {
            const result = document.getElementById('test-result');
            result.style.display = 'block';
            result.innerHTML = '<p>جاري تشغيل الاختبارات...</p>';

            setTimeout(() => {
                const tests = [
                    { name: 'حماية النماذج', passed: testFormProtection() },
                    { name: 'إدارة الجلسات', passed: testSessionManagement() },
                    { name: 'مراقبة النشاط', passed: testActivityMonitoring() },
                    { name: 'النسخ الاحتياطي', passed: testBackupSystem() }
                ];

                const passedTests = tests.filter(test => test.passed).length;
                
                result.innerHTML = `
                    <h4>نتائج الاختبارات: ${passedTests}/${tests.length} ناجحة</h4>
                    <ul>
                        ${tests.map(test => `
                            <li>${test.name}: <span style="color: ${test.passed ? 'green' : 'red'}">${test.passed ? '✅' : '❌'}</span></li>
                        `).join('')}
                    </ul>
                `;
            }, 2000);
        }

        function testFormProtection() {
            return document.querySelector('input[name="_security_token"]') !== null;
        }

        function testSessionManagement() {
            return sessionStorage.getItem('session_id') !== null;
        }

        function testActivityMonitoring() {
            return window.securitySystem && window.securitySystem.systems.activityMonitor;
        }

        function testBackupSystem() {
            return window.securitySystem && window.securitySystem.systems.backupManager;
        }

        function checkSystemHealth() {
            if (window.securitySystem) {
                window.securitySystem.healthCheck();
                alert('تم فحص صحة النظام - انظر console للتفاصيل');
            }
        }

        function viewSecurityLogs() {
            if (window.logger) {
                const logs = window.logger.getLogs();
                console.log('سجلات الأمان:', logs);
                alert('تم عرض السجلات - انظر console للتفاصيل');
            }
        }

        // تحديث المعلومات بانتظام
        setInterval(updateSystemStatus, 5000);
        setTimeout(updateSystemStatus, 1000);

        // تحديث معلومات الجلسة
        function updateSessionInfo() {
            const sessionInfo = document.getElementById('session-info');
            if (sessionStorage.getItem('session_id')) {
                sessionInfo.innerHTML = `
                    <p>معرف الجلسة: ${sessionStorage.getItem('session_id')}</p>
                    <p>آخر نشاط: ${new Date(parseInt(sessionStorage.getItem('last_activity') || '0')).toLocaleString()}</p>
                `;
            } else {
                sessionInfo.innerHTML = '<p>لا توجد جلسة نشطة</p>';
            }
        }
        setInterval(updateSessionInfo, 3000);
        updateSessionInfo();
    </script>
</body>
</html>